# История изменений

Все значимые изменения в проекте будут документироваться в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и этот проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

## [1.1.0] - 2025-01-XX

### Добавлено
- **Полная миграция на Core Data**
  - Создана модель данных `WardrobeModel.xcdatamodeld` с сущностями `ItemEntity` и `OutfitEntity`
  - Реализован `PersistenceController` для управления Core Data stack
  - Настроено автоматическое слияние изменений из фонового контекста

- **Сервисный слой для работы с данными**
  - `WardrobeDataService` - все операции записи для `ItemEntity` на фоновом контексте
  - `OutfitDataService` - все операции записи для `OutfitEntity` на фоновом контексте
  - `ImageFileManager` - управление изображениями в файловой системе

- **Расширения для Core Data сущностей**
  - `ItemEntity+Extensions` - маппинг строковых атрибутов на Swift Enums, загрузка изображений
  - `OutfitEntity+Extensions` - маппинг на Enums, работа с массивом UUID, загрузка изображений

- **Переработанные ViewModels (MVVM архитектура)**
  - `WardrobeViewModel` - логика фильтрации, построение NSPredicate для @FetchRequest
  - `OutfitViewModel` - управление комплектами, рекомендации
  - `RecommendationViewModel` - генерация рекомендаций на основе Core Data

- **Обновленные Views**
  - Все Views переписаны для работы с Core Data через `@FetchRequest`
  - `WardrobeView` - список предметов с фильтрацией
  - `HomeView` - главный экран с рекомендациями
  - `AddItemView` - добавление предметов с асинхронным сохранением
  - `ItemDetailView` - детали предмета с возможностью редактирования
  - `OutfitBuilderView` - создание и редактирование комплектов
  - `RecommendationsView` - AI рекомендации
  - `AnalyticsView` - аналитика и статистика
  - `CalendarView` - календарь для планирования образов
  - `FilterView` - фильтры для гардероба
  - `AIStylistChatView` - чат с AI стилистом

- **Типобезопасность**
  - Перечисления: `ClothingCategory`, `Season`, `Style`, `ClothingColor`, `Occasion`
  - Computed properties для безопасного доступа к enum значениям

### Изменено
- **Архитектура данных**
  - Миграция с `UserDefaults` и `struct ClothingItem` на Core Data `ItemEntity`
  - Миграция с `struct Outfit` на Core Data `OutfitEntity`
  - Все операции записи перенесены на фоновые контексты

- **Управление изображениями**
  - Изображения больше не хранятся в Core Data как Binary Data
  - Изображения сохраняются в файловой системе через `ImageFileManager`
  - Core Data хранит только `imageFileName` (UUID) как ссылку

- **Производительность**
  - Все операции записи выполняются асинхронно на фоновом контексте
  - Использование `@FetchRequest` для автоматического обновления UI
  - Оптимизированная загрузка изображений с диска

### Исправлено
- **Обработка опциональных типов**
  - Исправлена работа с опциональными `UUID?` в предикатах
  - Исправлена работа с опциональными скалярными типами (`Int32?` для rating)
  - Добавлены проверки для опциональных `Date?` перед форматированием

- **Компиляция**
  - Исправлены все ошибки компиляции связанные с опциональными типами
  - Добавлены недостающие `sortDescriptors` в `@FetchRequest`
  - Исправлена работа с `Transformable` атрибутами для массива UUID

### Технические детали

#### Core Data Stack
- `PersistenceController` инициализируется на фоновом контексте
- View context настроен на автоматическое слияние изменений
- Все write операции через `container.performBackgroundTask`

#### Изображения
- Формат: JPEG с качеством 0.8
- Хранение: `DocumentsDirectory/images/`
- Именование: UUID-based

#### Модель данных
- `ItemEntity`: 13 атрибутов, включая UUID, даты, опциональные поля
- `OutfitEntity`: 11 атрибутов, включая Transformable для массива UUID
- Все обязательные поля имеют значения по умолчанию где необходимо

---

## [1.0.0] - (Предыдущая версия)

### Исходная версия
- Базовая функциональность управления гардеробом
- Использование `UserDefaults` для хранения данных
- Struct-based модели (`ClothingItem`, `Outfit`)
- Базовый UI на SwiftUI

---

## Типы изменений

- **Добавлено** - для новых функций
- **Изменено** - для изменений в существующей функциональности
- **Устарело** - для функций, которые скоро будут удалены
- **Удалено** - для удаленных функций
- **Исправлено** - для исправления багов
- **Безопасность** - в случае уязвимостей

---

## Планы на будущее

### Версия 1.2.0 (Планируется)
- [ ] Реализация полноценного AI стилиста с интеграцией API
- [ ] Синхронизация с iCloud
- [ ] Экспорт/импорт данных
- [ ] Виджеты для главного экрана
- [ ] Уведомления о рекомендациях

### Версия 1.3.0 (Планируется)
- [ ] Социальные функции (делиться образами)
- [ ] Интеграция с календарем iOS
- [ ] Расширенная аналитика
- [ ] Темная тема с кастомизацией

---

**Примечание**: Даты версий указаны в формате YYYY-MM-DD

